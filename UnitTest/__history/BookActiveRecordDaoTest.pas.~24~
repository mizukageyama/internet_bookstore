unit BookActiveRecordDaoTest;

interface

uses
  DUnitX.TestFramework, Book, BookActiveRecordDaoStub,
  System.Generics.Collections, MockBookTableDatabase, BookDAOIntf;

type
  [TestFixture]
  TBookDAOUnitTests = class
  private
    FBookDAO: IBookDAO;
  public
    [Setup]
    procedure Setup;
    [TearDown]
    procedure TearDown;

    [Test]
    procedure TestInsertSuccess;
    [Test]
    procedure TestSelectSuccess;
    [Test]
    procedure TestSelectWhereIdSuccess;
    [Test]
    procedure TestUpdateSuccess;
    [Test]
    procedure TestDeleteSuccess;
  end;

implementation

procedure TBookDAOUnitTests.Setup;
begin
  FBookDAO := TBookDAO.Create;
end;

procedure TBookDAOUnitTests.TearDown;
begin
  FBookDAO := nil;
end;

procedure TBookDAOUnitTests.TestInsertSuccess;
var
  Book: TBook;
begin
  Book := TBook.Create;
  Book.Title := 'Sample Book';
  Book.Synopsis := 'A sample book synopsis.';

  FBookDAO.Insert(Book);

  // Check if the book was added to the mock database
  Assert.IsTrue(MockDatabase.Contains(Book.Id));
end;

procedure TBookDAOUnitTests.TestSelectSuccess;
var
  Books: TObjectList<TBook>;
begin
  Books := FBookDAO.Select;
  // Check if the returned list is not nil
  Assert.IsNotNull(Books);
end;

procedure TBookDAOUnitTests.TestSelectWhereIdSuccess;
var
  BookId: Integer;
  SelectedBook: TBook;
begin
  // Assuming there is a book with the specified BookId in the mock database
  BookId := 1;
  SelectedBook := FBookDAO.SelectWhereId(BookId);

  // Check if the selected book is not nil
  Assert.IsNotNull(SelectedBook);
  // Check if the selected book's ID matches the expected ID
  Assert.AreEqual(BookId, SelectedBook.Id);
end;

procedure TBookDAOUnitTests.TestUpdateSuccess;
var
  Book: TBook;
begin
  // Assuming there is a book with the specified BookId in the mock database
  Book := FBookDAO.SelectWhereId(1);
  if Assigned(Book) then
  begin
    // Modify some properties of the book
    Book.Title := 'Updated Title';
    Book.Synopsis := 'Updated Synopsis';

    FBookDAO.Update(Book);

    // Check if the book's properties are updated in the mock database
    Assert.AreEqual(Book.Title, TMockBookTableDatabase.GetBookById(1).Title);
    Assert.AreEqual(Book.Synopsis, MockDatabase.GetBookById(1).Synopsis);
  end;
end;

procedure TBookDAOUnitTests.TestDeleteSuccess;
var
  BookId: Integer;
begin
  // Assuming there is a book with the specified BookId in the mock database
  BookId := 1;

  FBookDAO.Delete(BookId);

  // Check if the book was removed from the mock database
  Assert.IsFalse(MockDatabase.Contains(BookId));
end;

initialization
  TDUnitX.RegisterTestFixture(TBookDAOUnitTests);

end.
